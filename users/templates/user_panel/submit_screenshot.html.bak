{% extends 'user_panel/base_user.html' %}

{% block content %}

<h2>Submit Screenshot for {{ app.name }}</h2>

<form method="POST" enctype="multipart/form-data" id="upload-form">
    {% csrf_token %}
    <div id="drop-area">
        <p>Drag & Drop Screenshot Here or Click to Select File</p>
        <input type="file" name="screenshot" id="fileElem" multiple hidden>
    </div>
    <ul id="file-list"></ul>
    <button type="submit">Upload</button>
</form>

<h3>My Uploaded Screenshots</h3>
<table>
    <tr>
        <th>Screenshot</th>
        <th>Status</th>
        <th>Submitted At</th>
    </tr>

    {% for sub in submissions %}
    <tr>
        <td>
            {% if sub.screenshot %}
                <img src="{{ sub.screenshot.url }}" width="100" alt="Screenshot">
            {% else %}
                No Screenshot
            {% endif %}
        </td>
        <td class="status-{{ sub.approved|yesno:"approved,pending" }}">
            {% if sub.approved %}Approved{% else %}Pending{% endif %}
        </td>
        <td>{{ sub.submitted_at|date:"M d, Y, h:i a" }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="3">No screenshots uploaded yet.</td>
    </tr>
    {% endfor %}
</table>

<style>
#drop-area {
    border: 2px dashed #ccc;
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    background: #f9f9f9;
    cursor: pointer;
    margin-top: 10px;
}
#drop-area.hover {
    border-color: #2c3e50;
    background: #e8f0fe;
}
</style>

<script>
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('fileElem');
const fileList = document.getElementById('file-list');

// Highlight on drag over
dropArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropArea.classList.add('hover');
});

// Remove highlight on drag leave
dropArea.addEventListener('dragleave', () => {
    dropArea.classList.remove('hover');
});

// Drop files
dropArea.addEventListener('drop', (e) => {
    e.preventDefault();
    dropArea.classList.remove('hover');
    fileInput.files = e.dataTransfer.files;
    updateFileList();
});

// Click to open file selector
dropArea.addEventListener('click', () => fileInput.click());

// Show selected file names
fileInput.addEventListener('change', updateFileList);

function updateFileList() {
    fileList.innerHTML = '';
    for (const file of fileInput.files) {
        const li = document.createElement('li');
        li.textContent = file.name;
        fileList.appendChild(li);
    }
}
</script>

{% endblock %}
